<%inherit file="base_admin.html" />
<script language="javascript" type="text/javascript">
function imposeMaxLength(Object, MaxLen)
{
  return (Object.value.length <= MaxLen);
}
</script>

<script type="text/javascript">
$(document).ready(function() {
	$("#emailnewtext").hide();

	$("#editnewemail").click(function(){
		$("#emailnewtext").show();
	})
});
</script>
<script type='text/javascript'>
function formValidator(){
	// Make quick references to our fields
	var customer_name = document.getElementById('customer_name');
	var company_name = document.getElementById('company_name');
	var location = document.getElementById('location');
	var mobile = document.getElementById('mobile');
	var landline = document.getElementById('landline');
	var email = document.getElementById('email');
	
	// Check each input in the order that it appears in the form!
	if(isAlphabet_s(customer_name, "Please enter only letters for your customer name")){
		if(isAlphabet_s(company_name, "Please enter only letters for your company name")){
			if(emailValidator(email, "Please enter a valid email address")){
				if(isNumeric(mobile, "Please enter only numbers for Number")){
					if(isNumeric(landline, "Please enter only numbers for Number")){
						return true;
					}
				}
			}
		}
	}
	return false;
}

function notEmpty(elem, helperMsg){
	if(elem.value.length == 0){
		alert(helperMsg);
		elem.focus(); // set the focus to this input
		return false;
	}
	return true;
}

function isNumeric(elem, helperMsg){
	var numericExpression = /^[0-9]+$/;
	if(elem.value.match(numericExpression)){
		return true;
	}else{
		alert(helperMsg);
		elem.focus();
		return false;
	}
}

function isAlphabet_s(elem, helperMsg){
	var alphaExp = /^[a-zA-Z ]+$/;
	if(elem.value.match(alphaExp)){
		return true;
	}else{
		alert(helperMsg);
		elem.focus();
		return false;
	}
}

function isAlphanumeric(elem, helperMsg){
	var alphaExp = /^[0-9a-zA-Z ]+$/;
	if(elem.value.match(alphaExp)){
		return true;
	}else{
		alert(helperMsg);
		elem.focus();
		return false;
	}
}

function lengthRestriction(elem, min, max){
	var uInput = elem.value;
	if(uInput.length >= min && uInput.length <= max){
		return true;
	}else{
		alert("Please enter between " +min+ " and " +max+ " characters");
		elem.focus();
		return false;
	}
}

function madeSelection(elem, helperMsg){
	if(elem.value == "Please Choose"){
		alert(helperMsg);
		elem.focus();
		return false;
	}else{
		return true;
	}
}

function emailValidator(elem, helperMsg){
	var emailExp = /^[\w\-\.\+]+\@[a-zA-Z0-9\.\-]+\.[a-zA-z0-9]{2,4}$/;
	if(elem.value.match(emailExp)){
		return true;
	}else{
		alert(helperMsg);
		elem.focus();
		return false;
	}
}

function modifycustomer()
{
	if (formValidator()){
	var customer_id = $("#customer_id").val();
	var customer_name = $("#customer_name").val();
	var company_name = $("#company_name").val();
	var location = $("#location").val();
	var landline = $("#landline").val();
	var mobile = $("#mobile").val();
	var email = $("#email").val();
	var username = $("#username").val();
	var password = $("#password").val();
	var role = $("#role").val();
	var dept = $("#dept").val();
	$.post("/customer/modify",{customer_id:customer_id, customer_name:customer_name, company_name:company_name, location:location, landline:landline, mobile:mobile,email:email,username:username,password:password,role:role,dept:dept},function(data){
		if(data == "1"){
			alert("Customer Data successfully modified");
			window.location.href="/customer/summary";
		}
		else if(data=="-1")
			{
			 alert("User does not exists");
			}
		else if(data == "2")
			{
			alert("Customer Data successfully modified");
			window.location.href="/customer/summary";
			}
		else{
			alert("Email_Id already Exist");		
		}
	});
	}
}
function addCustomer(){
	if (formValidator()){
	var customer_name = $("#customer_name").val();
	var company_name = $("#company_name").val();
	var email = $("#email").val();
	var location = $("#location").val();
	var mobile = $("#mobile").val();
	var landline = $("#landline").val();
	$.post("/customer/add",{customer_name:customer_name, company_name:company_name, email:email, location:location, mobile:mobile, landline:landline},function (data){
	if(data == "1"){
		alert("Customer is added.");
		window.location.href="/customer/summary";
		}
	else if(data == "0"){
		alert("Email_Id is already Exist.");
	}
	
	else{
		alert("Customer is already Exist.");
	}
	});
	}
}
function updateemail(custid)
{
	var emailnew = $("#emailnew").val();
	var email =  $("#email").val();
	if (emailnew == "")
	{
		$("#email").val(email);
	}
	else
	{
		if (emailnew == email)
		{
			alert("email id is same");
			return 0;
		}
		else
		{
			$.post("/customer/updateemail",{emailnew:emailnew,custid:custid},function (data){
			if(data == "1"){
				alert("Modify email");
				$("#email").val(emailnew);
			}
			
			else
			{
				alert("Email is already exsist");
			}
			});
		}
	}	
}
</script>
<form name="editcustomer" id="editcustomer" method="post" action="/customer/modify" style="margin:0 auto; width:80%;">
<input type="hidden" class="small" name="customer_id" id="customer_id" value="${customer[0]}" readonly><br/><br/>
<h4 style="color: #0064CD; text-decoration:underline;">General Information</h4>
<label>Customer Name:</label><br/><br/>
<input type="text" class="large" name="customer_name" id="customer_name" value="${customer[2]}" maxlength="100"><br/><br/>
<label>Company Name:</label><br/><br/>
<input type="text" class="large" name="company_name" id="company_name" value="${customer[1]}" maxlength="100"><br/><br/>
<label>Email Id:</label><br/><br/>
<input type="text" class="large" name="email" id="email" value="${customer[6]}" readonly> <img id="editnewemail" src="/images/edit.png"><br/><br/>
<span id="emailnewtext"><input type="text" class="large" name="emailnew" id="emailnew"> <input type="button" value="ok" id="${customer[0]}" onclick="javascript:updateemail(id)"></span><br/><br/>
<label>Location:</label><br/><br/>
<textarea class="large" name="location" id="location" style="resize:vertical; max-height:60px; min-height:60px;" onkeypress="return imposeMaxLength(this, 139);">${customer[3]}</textarea><br/><br/>
<label>Mobile No.:</label><br/><br/>
<input type="text" class="large" name="mobile" id="mobile" value="${customer[5]}" maxlength="15"><br/><br/>
<label>Landline No.:</label><br/><br/>
<input type="text" class="large" name="landline" id="landline" value="${customer[4]}" maxlength="20"><br/><br/>
%if userobj:
	<label>User Role.:</label><br/><br/>
	<input type="text" class="large" name="role" id="role" value="customer" readonly>
	</select><br/><br/>
	<label>User Name.:</label><br/><br/>
	<input type="text" class="large" name="username" id="username"  value="${userobj[5]}" maxlength="15" readonly><br/><br/>
	<label>Password.:</label><br/><br/>
	<input type="password" class="large" name="password" id="password"  value="" maxlength="20"><br/><br/>
%endif
<input type="button" value="Modify" name="modifydata" id="modifydata" onclick="javascript:modifycustomer();">
<input type="button" value="Cancel" name="Cancel" id="Cancel" onclick="window.location.href='/customer/summary'">
%if userobj:
	<script>setSelectedIndex("dept", ${userobj[4]})</script>
%endif
</form>
